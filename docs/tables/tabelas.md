# TABELAS

| table_schema | table_name               | columns                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ------------ | ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| public       | Clientes WhatsApp        | telefone numeric, nome text, status text, created_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| public       | Clientes WhatsApp_backup | telefone numeric, nome text, status text, created_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| public       | all_tenants_view         | id integer, name character varying(255), email character varying(255), phone character varying(50), plan character varying(20), status character varying(20), max_users integer, max_sessions_per_month integer, created_at timestamp with time zone, updated_at timestamp with time zone, approved_at timestamp with time zone, suspended_at timestamp with time zone, users_count bigint, players_count bigint, sessions_count bigint, total_volume numeric, last_session_date date, admin_name character varying(255)                                                                                           |
| public       | audit_logs               | id integer NOT NULL, tenant_id integer, user_id integer, action character varying(100) NOT NULL, table_name character varying(64), record_id integer, old_data jsonb, new_data jsonb, ip_address character varying(45), user_agent text, created_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                       |
| public       | client_secrets_decrypted | client_id uuid, name text, slug text, status text, meta_access_token text, meta_verify_token text, meta_phone_number_id text, openai_api_key text, groq_api_key text, system_prompt text, formatter_prompt text, settings jsonb, notification_email text                                                                                                                                                                                                                                                                                                                                                           |
| public       | clientes_whatsapp        | telefone numeric NOT NULL, nome text, status text, created_at timestamp with time zone NOT NULL, client_id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public       | clients                  | id uuid NOT NULL, name text NOT NULL, slug text NOT NULL, status text NOT NULL, plan text NOT NULL, meta_access_token_secret_id uuid NOT NULL, meta_verify_token_secret_id uuid NOT NULL, meta_phone_number_id text NOT NULL, meta_display_phone text, openai_api_key_secret_id uuid, openai_model text, groq_api_key_secret_id uuid, groq_model text, system_prompt text NOT NULL, formatter_prompt text, settings jsonb, notification_email text, notification_webhook_url text, created_at timestamp with time zone, updated_at timestamp with time zone, created_by uuid, primary_model_provider text NOT NULL |
| public       | conversations            | id uuid NOT NULL, client_id uuid, phone text NOT NULL, name text, status text, assigned_to text, last_message text, last_update timestamp with time zone, created_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                                                                      |
| public       | documents                | id bigint NOT NULL, content text, metadata jsonb, embedding USER-DEFINED, client_id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public       | execution_logs           | id bigint NOT NULL, execution_id uuid NOT NULL, node_name text NOT NULL, input_data jsonb, output_data jsonb, error jsonb, status text NOT NULL, duration_ms integer, timestamp timestamp with time zone NOT NULL, metadata jsonb, created_at timestamp with time zone NOT NULL                                                                                                                                                                                                                                                                                                                                    |
| public       | messages                 | id uuid NOT NULL, client_id uuid, conversation_id uuid, phone text NOT NULL, name text, content text NOT NULL, type text, direction text NOT NULL, status text, timestamp timestamp with time zone, metadata jsonb                                                                                                                                                                                                                                                                                                                                                                                                 |
| public       | n8n_chat_histories       | id integer NOT NULL, session_id character varying(255) NOT NULL, message jsonb NOT NULL, created_at timestamp with time zone, client_id uuid NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public       | player_transfers         | id integer NOT NULL, session_id integer NOT NULL, tenant_id integer NOT NULL, from_player_id integer, to_player_id integer, from_player_name character varying(255) NOT NULL, to_player_name character varying(255) NOT NULL, amount numeric NOT NULL, type character varying(20), status character varying(20), notes text, completed_at timestamp with time zone, created_at timestamp with time zone, updated_at timestamp with time zone                                                                                                                                                                       |
| public       | players                  | id integer NOT NULL, tenant_id integer NOT NULL, name character varying(255) NOT NULL, nickname character varying(100), phone character varying(50), notes text, is_active boolean, created_at timestamp with time zone, updated_at timestamp with time zone, user_id integer, total_sessions integer, total_buyin numeric, total_cashout numeric, total_profit numeric, win_rate numeric, avg_session_time integer, best_session numeric, worst_session numeric, last_played timestamp with time zone                                                                                                             |
| public       | pricing_config           | id uuid NOT NULL, client_id uuid NOT NULL, provider text NOT NULL, model text NOT NULL, prompt_price numeric NOT NULL, completion_price numeric NOT NULL, unit text, created_at timestamp with time zone, updated_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                                                      |
| public       | sessions                 | id integer NOT NULL, tenant_id integer NOT NULL, date date NOT NULL, location character varying(255) NOT NULL, status character varying(20), created_by integer NOT NULL, created_at timestamp with time zone, updated_at timestamp with time zone, approved_at timestamp with time zone, closed_at timestamp with time zone, players_data jsonb, recommendations jsonb, paid_transfers jsonb, session_fee numeric, janta_fee numeric, rake_percentage numeric, total_buyin numeric, total_cashout numeric, total_profit numeric, players_count integer                                                            |
| public       | super_admin_stats        | total_tenants bigint, active_tenants bigint, total_users bigint, active_users bigint, total_players bigint, total_sessions bigint, total_volume numeric, sessions_last_30_days bigint                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public       | tenants                  | id integer NOT NULL, name character varying(255) NOT NULL, email character varying(255) NOT NULL, phone character varying(50), plan character varying(20), status character varying(20), max_users integer, max_sessions_per_month integer, created_at timestamp with time zone, updated_at timestamp with time zone, approved_at timestamp with time zone, suspended_at timestamp with time zone                                                                                                                                                                                                                  |
| public       | usage_logs               | id uuid NOT NULL, client_id uuid, conversation_id uuid, phone text NOT NULL, source text NOT NULL, model text, prompt_tokens integer, completion_tokens integer, total_tokens integer, cost_usd numeric, messages_sent integer, metadata jsonb, created_at timestamp with time zone                                                                                                                                                                                                                                                                                                                                |
| public       | user_invites             | id integer NOT NULL, tenant_id integer NOT NULL, invited_by_user_id integer NOT NULL, email character varying(255) NOT NULL, name character varying(255), role character varying(20), invite_token character varying(128) NOT NULL, status character varying(20), expires_at timestamp with time zone NOT NULL, accepted_at timestamp with time zone, created_at timestamp with time zone, updated_at timestamp with time zone, player_id integer                                                                                                                                                                  |
| public       | user_profiles            | id uuid NOT NULL, client_id uuid NOT NULL, email text NOT NULL, full_name text, created_at timestamp with time zone NOT NULL, updated_at timestamp with time zone NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public       | users                    | id integer NOT NULL, tenant_id integer NOT NULL, name character varying(255) NOT NULL, email character varying(255) NOT NULL, password_hash character varying(255) NOT NULL, role character varying(20), is_active boolean, last_login timestamp with time zone, created_at timestamp with time zone, updated_at timestamp with time zone, player_id integer                                                                                                                                                                                                                                                       |
# POLITICAS RLS

| table_schema | table_name        | policy_name                                  | using_expression                                                                                                                                                                                                                                      | with_check_expression                                                                                                                                                                                                                                 | for_command | roles |
| ------------ | ----------------- | -------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ----- |
| public       | audit_logs        | Admins can view audit logs from their tenant | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | audit_logs        | System can insert audit logs                 | null                                                                                                                                                                                                                                                  | true                                                                                                                                                                                                                                                  | I           | [0]   |
| public       | audit_logs        | audit_logs_insert                            | null                                                                                                                                                                                                                                                  | true                                                                                                                                                                                                                                                  | I           | [0]   |
| public       | audit_logs        | audit_logs_select                            | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | clientes_whatsapp | n8n                                          | true                                                                                                                                                                                                                                                  | null                                                                                                                                                                                                                                                  | *           | [0]   |
| public       | clients           | Enable read access for all users             | true                                                                                                                                                                                                                                                  | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | conversations     | Service role can access all conversations    | (auth.role() = 'service_role'::text)                                                                                                                                                                                                                  | null                                                                                                                                                                                                                                                  | *           | [0]   |
| public       | documents         | n8n                                          | true                                                                                                                                                                                                                                                  | null                                                                                                                                                                                                                                                  | *           | [0]   |
| public       | execution_logs    | Enable insert for service role only          | null                                                                                                                                                                                                                                                  | (auth.role() = 'service_role'::text)                                                                                                                                                                                                                  | I           | [0]   |
| public       | execution_logs    | Enable read access for authenticated users   | ((auth.role() = 'authenticated'::text) OR (auth.role() = 'service_role'::text))                                                                                                                                                                       | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | messages          | Service role can access all messages         | (auth.role() = 'service_role'::text)                                                                                                                                                                                                                  | null                                                                                                                                                                                                                                                  | *           | [0]   |
| public       | player_transfers  | tenant_isolation_transfers_delete            | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | player_transfers  | tenant_isolation_transfers_insert            | null                                                                                                                                                                                                                                                  | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = ANY (ARRAY['admin'::text, 'player'::text])))) | I           | [0]   |
| public       | player_transfers  | tenant_isolation_transfers_select            | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR (tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer))                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | player_transfers  | tenant_isolation_transfers_update            | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = ANY (ARRAY['admin'::text, 'player'::text])))) | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | players           | Admins can delete players in their tenant    | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | players           | Users can create players in their tenant     | null                                                                                                                                                                                                                                                  | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | I           | [0]   |
| public       | players           | Users can update players in their tenant     | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | players           | Users can view players from their tenant     | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | players           | tenant_isolation_players_delete              | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | players           | tenant_isolation_players_insert              | null                                                                                                                                                                                                                                                  | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = ANY (ARRAY['admin'::text, 'player'::text])))) | I           | [0]   |
| public       | players           | tenant_isolation_players_select              | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR (tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer))                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | players           | tenant_isolation_players_update              | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = ANY (ARRAY['admin'::text, 'player'::text])))) | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | pricing_config    | Users can delete own client pricing config   | (client_id IN ( SELECT user_profiles.client_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                        | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | pricing_config    | Users can insert own client pricing config   | null                                                                                                                                                                                                                                                  | (client_id IN ( SELECT user_profiles.client_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                        | I           | [0]   |
| public       | pricing_config    | Users can update own client pricing config   | (client_id IN ( SELECT user_profiles.client_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                        | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | pricing_config    | Users can view own client pricing config     | (client_id IN ( SELECT user_profiles.client_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))                                                                                                                                        | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | sessions          | Admins can delete sessions in their tenant   | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | sessions          | Users can create sessions in their tenant    | null                                                                                                                                                                                                                                                  | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | I           | [0]   |
| public       | sessions          | Users can update sessions in their tenant    | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | sessions          | Users can view sessions from their tenant    | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | sessions          | tenant_isolation_sessions_delete             | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | sessions          | tenant_isolation_sessions_insert             | null                                                                                                                                                                                                                                                  | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = ANY (ARRAY['admin'::text, 'player'::text])))) | I           | [0]   |
| public       | sessions          | tenant_isolation_sessions_select             | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR (tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer))                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | sessions          | tenant_isolation_sessions_update             | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = ANY (ARRAY['admin'::text, 'player'::text])))) | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | tenants           | Admins can update their tenant               | ((id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                        | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | tenants           | Super admins can create tenants              | null                                                                                                                                                                                                                                                  | user_has_role('super_admin'::text)                                                                                                                                                                                                                    | I           | [0]   |
| public       | tenants           | Super admins can delete tenants              | user_has_role('super_admin'::text)                                                                                                                                                                                                                    | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | tenants           | Users can view their own tenant              | (id = get_user_tenant_id())                                                                                                                                                                                                                           | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | tenants           | super_admin_all_tenants                      | ((auth.jwt() ->> 'role'::text) = 'super_admin'::text)                                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | *           | [0]   |
| public       | tenants           | users_own_tenant                             | (id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer)                                                                                                                                                      | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | usage_logs        | Service role can access all usage logs       | (auth.role() = 'service_role'::text)                                                                                                                                                                                                                  | null                                                                                                                                                                                                                                                  | *           | [0]   |
| public       | user_invites      | Admins can create invites in their tenant    | null                                                                                                                                                                                                                                                  | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | I           | [0]   |
| public       | user_invites      | Admins can delete invites in their tenant    | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | user_invites      | Admins can update invites in their tenant    | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | user_invites      | Users can view invites from their tenant     | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | user_invites      | tenant_isolation_invites_delete              | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | user_invites      | tenant_isolation_invites_insert              | null                                                                                                                                                                                                                                                  | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | I           | [0]   |
| public       | user_invites      | tenant_isolation_invites_select              | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR (tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer))                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | user_invites      | tenant_isolation_invites_update              | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | user_profiles     | Client admins can view team members          | (client_id = ( SELECT up.client_id
   FROM user_profiles up
  WHERE (up.id = auth.uid())))                                                                                                                                                            | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | user_profiles     | Users can update own profile                 | (id = auth.uid())                                                                                                                                                                                                                                     | (id = auth.uid())                                                                                                                                                                                                                                     | U           | [0]   |
| public       | user_profiles     | Users can view own profile                   | (id = auth.uid())                                                                                                                                                                                                                                     | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | users             | Admins can create users in their tenant      | null                                                                                                                                                                                                                                                  | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | I           | [0]   |
| public       | users             | Admins can delete users in their tenant      | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | users             | Admins can update users in their tenant      | ((tenant_id = get_user_tenant_id()) AND user_has_role('admin'::text))                                                                                                                                                                                 | null                                                                                                                                                                                                                                                  | U           | [0]   |
| public       | users             | Users can view users from their tenant       | (tenant_id = get_user_tenant_id())                                                                                                                                                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | users             | tenant_isolation_users_delete                | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR ((tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer) AND ((auth.jwt() ->> 'role'::text) = 'admin'::text)))                              | null                                                                                                                                                                                                                                                  | D           | [0]   |
| public       | users             | tenant_isolation_users_insert                | null                                                                                                                                                                                                                                                  | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR (tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer))                                                                                    | I           | [0]   |
| public       | users             | tenant_isolation_users_select                | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR (tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer))                                                                                    | null                                                                                                                                                                                                                                                  | S           | [0]   |
| public       | users             | tenant_isolation_users_update                | (((auth.jwt() ->> 'role'::text) = 'super_admin'::text) OR (tenant_id = (NULLIF(((auth.jwt() -> 'app_metadata'::text) ->> 'tenant_id'::text), ''::text))::integer))                                                                                    | null                                                                                                                                                                                                                                                  | U           | [0]   |

# TRIGGERS

| table_schema | table_name        | trigger_name                          | trigger_definition                                                                                                                                          | function_name                   |
| ------------ | ----------------- | ------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------- |
| public       | Clientes WhatsApp | clientes_whatsapp_view_insert_trigger | CREATE TRIGGER clientes_whatsapp_view_insert_trigger INSTEAD OF INSERT ON "Clientes WhatsApp" FOR EACH ROW EXECUTE FUNCTION clientes_whatsapp_view_insert() | clientes_whatsapp_view_insert   |
| public       | Clientes WhatsApp | clientes_whatsapp_view_update_trigger | CREATE TRIGGER clientes_whatsapp_view_update_trigger INSTEAD OF UPDATE ON "Clientes WhatsApp" FOR EACH ROW EXECUTE FUNCTION clientes_whatsapp_view_update() | clientes_whatsapp_view_update   |
| public       | clients           | update_clients_updated_at             | CREATE TRIGGER update_clients_updated_at BEFORE UPDATE ON clients FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                                  | update_updated_at_column        |
| public       | player_transfers  | update_transfers_updated_at           | CREATE TRIGGER update_transfers_updated_at BEFORE UPDATE ON player_transfers FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                       | update_updated_at_column        |
| public       | players           | update_players_updated_at             | CREATE TRIGGER update_players_updated_at BEFORE UPDATE ON players FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                                  | update_updated_at_column        |
| public       | pricing_config    | pricing_config_updated_at             | CREATE TRIGGER pricing_config_updated_at BEFORE UPDATE ON pricing_config FOR EACH ROW EXECUTE FUNCTION update_pricing_config_timestamp()                    | update_pricing_config_timestamp |
| public       | sessions          | update_sessions_updated_at            | CREATE TRIGGER update_sessions_updated_at BEFORE UPDATE ON sessions FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                                | update_updated_at_column        |
| public       | tenants           | update_tenants_updated_at             | CREATE TRIGGER update_tenants_updated_at BEFORE UPDATE ON tenants FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                                  | update_updated_at_column        |
| public       | user_invites      | update_invites_updated_at             | CREATE TRIGGER update_invites_updated_at BEFORE UPDATE ON user_invites FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                             | update_updated_at_column        |
| public       | user_profiles     | update_user_profiles_updated_at       | CREATE TRIGGER update_user_profiles_updated_at BEFORE UPDATE ON user_profiles FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                      | update_updated_at_column        |
| public       | users             | update_users_updated_at               | CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()                                      | update_updated_at_column        |

# FUNÇÕES





## RODAR ESSE COMANDO PARA VER AS TABELAS

``` bash
SELECT
  table_schema,
  table_name,
  string_agg(column_name || ' ' || data_type || coalesce('(' || character_maximum_length || ')','') 
            || CASE WHEN is_nullable = 'NO' THEN ' NOT NULL' ELSE '' END, ', ' ORDER BY ordinal_position) AS columns
FROM information_schema.columns
WHERE table_schema = 'public'  -- ajuste o schema
GROUP BY table_schema, table_name
ORDER BY table_schema, table_name;
```

OU
``` bash
SELECT
  n.nspname AS table_schema,
  c.relname AS table_name,
  a.attname AS column_name,
  pg_catalog.format_type(a.atttypid, a.atttypmod) AS data_type,
  NOT a.attnotnull AS is_nullable,
  pg_get_expr(d.adbin, d.adrelid) AS column_default,
  a.attnum AS ordinal_position
FROM pg_catalog.pg_attribute a
JOIN pg_catalog.pg_class c ON a.attrelid = c.oid
JOIN pg_catalog.pg_namespace n ON c.relnamespace = n.oid
LEFT JOIN pg_catalog.pg_attrdef d ON a.attrelid = d.adrelid AND a.attnum = d.adnum
WHERE c.relkind = 'r'                     -- only regular tables
  AND n.nspname = 'public'                -- troque para o schema desejado
  AND a.attnum > 0
ORDER BY n.nspname, c.relname, a.attnum;
```

OU

``` bash
SELECT
  table_schema,
  table_name,
  column_name,
  data_type,
  is_nullable,
  column_default,
  ordinal_position
FROM information_schema.columns
WHERE table_schema = 'public'  -- troque para o schema desejado, ex: 'auth'
ORDER BY table_schema, table_name, ordinal_position;
```


## PARA VER AS POLITICAS

``` bash
-- Lista políticas RLS por tabela no schema especificado
SELECT
  nsp.nspname AS table_schema,
  cls.relname AS table_name,
  pol.polname AS policy_name,
  pg_get_expr(pol.polqual, pol.polrelid)   AS using_expression,
  pg_get_expr(pol.polwithcheck, pol.polrelid) AS with_check_expression,
  CASE pol.polcmd
    WHEN 'r' THEN 'SELECT'
    WHEN 'w' THEN 'UPDATE'
    WHEN 'a' THEN 'INSERT'
    WHEN 'd' THEN 'DELETE'
    WHEN 'l' THEN 'ALL'
    ELSE pol.polcmd
  END AS for_command,
  pol.polroles AS roles
FROM pg_catalog.pg_policy pol
JOIN pg_catalog.pg_class cls ON pol.polrelid = cls.oid
JOIN pg_catalog.pg_namespace nsp ON cls.relnamespace = nsp.oid
WHERE nsp.nspname = 'public'  -- troque para o schema desejado (ex.: 'auth')
ORDER BY table_schema, table_name, policy_name;
```

## PARA VER OS TRIGGERS

``` bash
-- Lista triggers definidos no schema (tabela, evento, função de trigger)
SELECT
  n.nspname AS table_schema,
  c.relname AS table_name,
  t.tgname AS trigger_name,
  pg_get_triggerdef(t.oid, true) AS trigger_definition,
  p.proname AS function_name
FROM pg_trigger t
JOIN pg_class c ON t.tgrelid = c.oid
JOIN pg_namespace n ON c.relnamespace = n.oid
LEFT JOIN pg_proc p ON t.tgfoid = p.oid
WHERE n.nspname = 'public'  -- troque para o schema desejado
  AND NOT t.tgisinternal       -- exclui triggers internos do sistema
ORDER BY table_schema, table_name, trigger_name;
```

## PARA VER AS FUNÇÕES

``` bash
-- Lista funções no schema com assinatura e definição
SELECT
  n.nspname AS function_schema,
  p.proname AS function_name,
  pg_get_function_arguments(p.oid) AS arguments,
  pg_get_function_result(p.oid) AS return_type,
  pg_get_functiondef(p.oid) AS definition
FROM pg_proc p
JOIN pg_namespace n ON p.pronamespace = n.oid
WHERE n.nspname = 'public'  -- troque para o schema desejado
ORDER BY function_schema, function_name;
```

## PARA VER AS Constraints e foreign keys

``` bash
SELECT
  tc.table_schema,
  tc.table_name,
  kcu.column_name,
  ccu.table_schema AS foreign_table_schema,
  ccu.table_name AS foreign_table_name,
  ccu.column_name AS foreign_column_name,
  tc.constraint_name
FROM information_schema.table_constraints AS tc
JOIN information_schema.key_column_usage AS kcu
  ON tc.constraint_name = kcu.constraint_name AND tc.table_schema = kcu.table_schema
JOIN information_schema.constraint_column_usage AS ccu
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
  AND ccu.table_name = 'users'   -- tabela referenciada
  AND ccu.column_name = 'id'
  AND ccu.table_schema = 'auth'; -- schema da tabela users
```
## PARA VER  políticas específicas de uma tabela

``` bash

SELECT
  pol.polname AS policy_name,
  pg_get_expr(pol.polqual, pol.polrelid)   AS using_expression,
  pg_get_expr(pol.polwithcheck, pol.polrelid) AS with_check_expression,
  CASE pol.polcmd
    WHEN 'r' THEN 'SELECT'
    WHEN 'w' THEN 'UPDATE'
    WHEN 'a' THEN 'INSERT'
    WHEN 'd' THEN 'DELETE'
    WHEN 'l' THEN 'ALL'
    ELSE pol.polcmd
  END AS for_command,
  pol.polroles AS roles
FROM pg_catalog.pg_policy pol
JOIN pg_catalog.pg_class cls ON pol.polrelid = cls.oid
JOIN pg_catalog.pg_namespace nsp ON cls.relnamespace = nsp.oid
WHERE nsp.nspname = 'public'   -- schema da tabela
  AND cls.relname = 'sua_tabela_aqui'  -- substitua pelo nome da tabela
ORDER BY policy_name;